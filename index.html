<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Life Audit Command Center</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: light dark;
      --bg: #0f172a;
      --bg-alt: #111827;
      --card: rgba(15, 23, 42, 0.78);
      --card-light: #f8fafc;
      --primary: #38bdf8;
      --accent: #f472b6;
      --success: #34d399;
      --warning: #fbbf24;
      --danger: #f87171;
      --text: #e2e8f0;
      --text-dark: #0f172a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Figtree", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(160deg, rgba(15, 23, 42, 0.96), rgba(30, 41, 59, 0.96)),
        url("https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=1600&q=80") center/cover fixed;
      color: var(--text);
      min-height: 100vh;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: clamp(1.5rem, 3vw, 3rem);
    }

    header {
      display: grid;
      gap: 1rem;
      padding-bottom: 2rem;
    }

    header h1 {
      margin: 0;
      font-size: clamp(2rem, 4vw, 3.5rem);
      font-weight: 700;
      line-height: 1.1;
    }

    header p {
      margin: 0;
      max-width: 720px;
      font-size: 1.1rem;
      color: rgba(226, 232, 240, 0.85);
    }

    .badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 0.5rem;
    }

    .badge {
      padding: 0.3rem 0.75rem;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.14);
      border: 1px solid rgba(56, 189, 248, 0.4);
      color: var(--text);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    nav {
      position: sticky;
      top: 0.75rem;
      z-index: 10;
      margin-bottom: 1.5rem;
      backdrop-filter: blur(16px);
    }

    nav .nav-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      background: rgba(15, 23, 42, 0.72);
      border: 1px solid rgba(148, 163, 184, 0.25);
      border-radius: 12px;
      padding: 0.5rem;
    }

    nav button {
      flex: 1 1 140px;
      background: rgba(30, 64, 175, 0.25);
      color: var(--text);
      border: none;
      border-radius: 9px;
      padding: 0.6rem 1rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    nav button:hover,
    nav button:focus {
      outline: none;
      background: rgba(56, 189, 248, 0.25);
      transform: translateY(-1px);
    }

    section {
      margin-bottom: clamp(2rem, 5vw, 3.5rem);
    }

    section h2 {
      margin-bottom: 1rem;
      font-size: clamp(1.6rem, 3vw, 2.4rem);
      font-weight: 600;
    }

    .section-intro {
      margin-bottom: 1.5rem;
      max-width: 740px;
      color: rgba(226, 232, 240, 0.78);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
    }

    .card {
      background: rgba(15, 23, 42, 0.82);
      border: 1px solid rgba(148, 163, 184, 0.18);
      border-radius: 16px;
      padding: 1.25rem;
      display: grid;
      gap: 0.75rem;
      min-height: 100%;
      box-shadow: 0 18px 38px rgba(15, 23, 42, 0.35);
    }

    .card.light {
      background: rgba(248, 250, 252, 0.9);
      color: var(--text-dark);
    }

    .card h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .card p,
    .card li {
      margin: 0;
      color: rgba(226, 232, 240, 0.82);
      line-height: 1.5;
    }

    .card.light p,
    .card.light li {
      color: rgba(30, 41, 59, 0.88);
    }

    .card ul {
      padding-left: 1.1rem;
      display: grid;
      gap: 0.4rem;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: rgba(148, 163, 184, 0.85);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.65rem;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.18);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .tag.urgent {
      background: rgba(248, 113, 113, 0.22);
      color: #fecaca;
    }

    .tag.priority {
      background: rgba(52, 211, 153, 0.22);
      color: #bbf7d0;
    }

    .strategy-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
      padding: 1rem;
      border: 1px dashed rgba(148, 163, 184, 0.4);
      border-radius: 16px;
      background: rgba(30, 41, 59, 0.38);
    }

    .strategy-controls form {
      display: grid;
      gap: 0.8rem;
      flex: 1 1 320px;
    }

    .strategy-controls label {
      font-size: 0.85rem;
      color: rgba(226, 232, 240, 0.85);
      font-weight: 500;
      letter-spacing: 0.02em;
    }

    .strategy-controls input,
    .strategy-controls textarea,
    .strategy-controls select {
      width: 100%;
      padding: 0.55rem 0.65rem;
      border-radius: 8px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.6);
      color: var(--text);
      font-size: 0.95rem;
      font-family: inherit;
      resize: vertical;
    }

    .strategy-controls button {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.8), rgba(147, 51, 234, 0.8));
      border: none;
      color: white;
      padding: 0.65rem 1rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .strategy-controls button:hover {
      transform: translateY(-1px);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      overflow: hidden;
      border-radius: 16px;
    }

    thead {
      background: rgba(56, 189, 248, 0.18);
      color: var(--text);
    }

    th,
    td {
      padding: 0.9rem;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.18);
      font-size: 0.9rem;
    }

    tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.65);
    }

    tbody tr:nth-child(even) {
      background: rgba(30, 41, 59, 0.55);
    }

    .status-select,
    .progress-input {
      width: 100%;
      padding: 0.4rem 0.5rem;
      border-radius: 8px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.55);
      color: var(--text);
      font-family: inherit;
      font-size: 0.85rem;
    }

    .progress-bar {
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.35);
      overflow: hidden;
      margin-top: 0.35rem;
    }

    .progress-bar span {
      display: block;
      height: 100%;
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.85), rgba(147, 51, 234, 0.85));
    }

    .micro-rituals {
      display: grid;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .micro-rituals .card ul {
      margin: 0;
    }

    .dashboard-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .metric-card {
      background: rgba(15, 23, 42, 0.78);
      border: 1px solid rgba(148, 163, 184, 0.25);
      border-radius: 16px;
      padding: 1rem;
      display: grid;
      gap: 0.65rem;
    }

    .metric-card h3 {
      margin: 0;
      font-size: 1rem;
      letter-spacing: 0.03em;
    }

    .metric-card input[type="number"] {
      width: 100%;
      padding: 0.5rem 0.65rem;
      border-radius: 8px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.6);
      color: var(--text);
      font-size: 1rem;
    }

    .metric-card small {
      color: rgba(148, 163, 184, 0.8);
    }

    .note-area {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }

    textarea.journal {
      min-height: 160px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.6);
      padding: 1rem;
      color: var(--text);
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
    }

    .quick-wins {
      display: grid;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .quick-wins input,
    .quick-wins button {
      padding: 0.6rem 0.8rem;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.55);
      color: var(--text);
      font-size: 0.95rem;
    }

    .quick-wins button {
      cursor: pointer;
      border: none;
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.85), rgba(16, 185, 129, 0.85));
      color: white;
      font-weight: 600;
    }

    .quick-wins ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.5rem;
    }

    .quick-wins li {
      background: rgba(34, 197, 94, 0.12);
      border: 1px solid rgba(34, 197, 94, 0.35);
      border-radius: 12px;
      padding: 0.6rem 0.75rem;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .quick-wins li button {
      background: none;
      border: none;
      color: rgba(248, 113, 113, 0.9);
      padding: 0.3rem 0.4rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .summary-banner {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 16px;
      background: linear-gradient(120deg, rgba(56, 189, 248, 0.25), rgba(99, 102, 241, 0.25));
      border: 1px solid rgba(148, 163, 184, 0.25);
      display: grid;
      gap: 0.75rem;
    }

    .summary-banner strong {
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 0.75rem;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .button-row button {
      padding: 0.65rem 1.1rem;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.55);
      color: var(--text);
      cursor: pointer;
      font-weight: 600;
    }

    .button-row button.primary {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.85), rgba(6, 182, 212, 0.85));
      border: none;
    }

    footer {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(148, 163, 184, 0.25);
      color: rgba(148, 163, 184, 0.8);
      font-size: 0.85rem;
      text-align: center;
    }

    @media (max-width: 720px) {
      nav {
        position: static;
      }

      nav .nav-container {
        border-radius: 16px;
      }

      table,
      thead,
      tbody,
      th,
      td,
      tr {
        display: block;
      }

      thead {
        display: none;
      }

      tbody tr {
        margin-bottom: 1rem;
        border-radius: 16px;
        overflow: hidden;
      }

      td {
        border: none;
        padding: 0.6rem 0.9rem;
        position: relative;
        padding-left: 55%;
      }

      td::before {
        content: attr(data-label);
        position: absolute;
        left: 0.9rem;
        top: 50%;
        transform: translateY(-50%);
        font-weight: 600;
        font-size: 0.78rem;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: rgba(148, 163, 184, 0.9);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="badges">
        <span class="badge">Life Audit Framework</span>
        <span class="badge">Diagnostic → Strategy → Execution</span>
        <span class="badge">Adaptive • Personal • Evolving</span>
      </div>
      <h1>Get It Together 5000 — Your Command Center for a Comeback</h1>
      <p>
        This space consolidates your current reality, the prioritized moves that stabilize it, and the execution rhythm that
        locks in momentum. Update progress daily, capture wins, and adapt the strategy anytime — your data is saved locally
        so the dashboard evolves with you.
      </p>
    </header>

    <nav>
      <div class="nav-container">
        <button data-scroll="diagnostic">Diagnostic</button>
        <button data-scroll="strategy">Strategy</button>
        <button data-scroll="execution">Execution</button>
        <button data-scroll="rituals">Rituals</button>
        <button data-scroll="dashboard">Dashboard</button>
        <button data-scroll="notes">Notes & Wins</button>
      </div>
    </nav>

    <main>
      <section id="diagnostic">
        <h2>Layer 1 — Diagnostic (Condensed)</h2>
        <p class="section-intro">
          You are carrying an elevated threat load across fatherhood, professional, health, finance, and relationships. The
          keystone risk is job security; the bottleneck is executive function under sustained stress. Use this summary to stay
          grounded in what is true today.
        </p>
        <div class="grid" id="diagnostic-grid"></div>
      </section>

      <section id="strategy">
        <h2>Layer 2 — Strategy (Prioritized)</h2>
        <p class="section-intro">
          Actions are ranked with your rubric (Impact, Urgency, Time-to-First-Win, Reversibility, Effort/Cost; Job Security ×1.25).
          Focus on the leading moves that de-risk termination, restore capacity, and rebuild support systems.
        </p>
        <div class="grid" id="strategy-grid"></div>

        <div class="strategy-controls">
          <form id="strategy-form">
            <div>
              <label for="strategy-title">Add a Strategic Move</label>
              <input type="text" id="strategy-title" name="title" placeholder="e.g., Weekly peer supervision huddle" required />
            </div>
            <div>
              <label for="strategy-purpose">Why it matters</label>
              <textarea id="strategy-purpose" name="purpose" rows="3" placeholder="What problem does this solve?" required></textarea>
            </div>
            <div>
              <label for="strategy-lever">Primary lever</label>
              <select id="strategy-lever" name="lever">
                <option value="job-security">Job Security</option>
                <option value="energy">Energy & Recovery</option>
                <option value="relationships">Relationships</option>
                <option value="financial">Financial Stability</option>
                <option value="mindset">Mindset & Resilience</option>
              </select>
            </div>
            <div>
              <label for="strategy-score">Priority score (1-10)</label>
              <input type="number" id="strategy-score" name="score" min="1" max="10" value="6" />
            </div>
            <button type="submit">Save Strategy</button>
          </form>
          <div class="summary-banner" id="strategy-summary">
            <strong>Current Emphasis</strong>
            <div id="top-lever-text">Job security remains the keystone. Protect the license, reduce backlog, and rebuild momentum.</div>
            <small>Update or add strategic moves whenever context shifts. Reset the board with the button below.</small>
            <div class="button-row">
              <button id="recalculate-btn" class="primary" type="button">Recalculate Focus</button>
              <button id="reset-btn" type="button">Reset to Original 8</button>
            </div>
          </div>
        </div>
      </section>

      <section id="execution">
        <h2>Layer 3 — Execution (7-Day Sprint)</h2>
        <p class="section-intro">
          Protect two 30-minute chart sprints daily, make friction vanish via the Chart-Assist Kit, and shield your nervous system
          with boundaries and sleep hygiene. Track progress live below. Status and progress values persist locally.
        </p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Objective</th>
                <th>7-Day Milestone</th>
                <th>Benefit</th>
                <th>Risk & Mitigation</th>
                <th>Status</th>
                <th>Progress</th>
              </tr>
            </thead>
            <tbody id="roadmap-body"></tbody>
          </table>
        </div>
      </section>

      <section id="rituals">
        <h2>Fatherhood Rituals & Support Systems</h2>
        <p class="section-intro">
          Protect the bond with predictable micro-rituals and professional tone. Keep support structures visible so you can choose
          connection over isolation.
        </p>
        <div class="micro-rituals" id="rituals-container"></div>
      </section>

      <section id="dashboard">
        <h2>Progress Dashboard</h2>
        <p class="section-intro">
          Track the leading indicators that tell you if the flywheel is spinning: work security, connection, recovery, movement,
          and cash flow. Adjust the numbers daily; the board keeps your latest entries.
        </p>
        <div class="dashboard-grid" id="metrics-grid"></div>
      </section>

      <section id="notes">
        <h2>Notes, Reflection, and Quick Wins</h2>
        <p class="section-intro">
          Capture insights, affirmations, or friction points. Log daily wins to reinforce progress. This page is for you only —
          everything is stored on this device.
        </p>
        <div class="note-area">
          <label for="journal">Reflection Journal</label>
          <textarea id="journal" class="journal" placeholder="Stream-of-consciousness, decisions made, obstacles noticed..."></textarea>
          <div class="quick-wins">
            <label for="quick-win-input">Log a quick win</label>
            <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
              <input type="text" id="quick-win-input" placeholder="e.g., Closed 6 charts before noon" style="flex:1 1 220px;" />
              <button type="button" id="add-win">Add Win</button>
            </div>
            <ul id="wins-list"></ul>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>
        Designed for adaptive self-command. When ready, say “Show Roadmap progress check-in” to yourself and review what moved.
      </p>
    </footer>
  </div>

  <script>
    const defaultState = {
      diagnostic: [
        {
          id: "fatherhood",
          title: "Fatherhood",
          summary:
            "High-conflict co-parenting, ongoing alienation, and social isolation from your son’s circle; defamatory messaging arrives through the court app.",
          focus: [
            "Hold boundaries with BIFF-style replies.",
            "Batch court app reviews to protect your nervous system.",
            "Keep a clean evidence log."
          ],
          meta: "Threat load high; emotional bleed impacts executive function"
        },
        {
          id: "professional",
          title: "Professional",
          summary:
            "~650 overdue tasks with ~150 incomplete charts. Termination anxiety fueling avoidance. Work is meaningful but taxing.",
          focus: [
            "Daily chart closure sprints (2 × 30 min).",
            "Chart-Assist Kit to remove friction.",
            "Single-queue task board to prevent overwhelm."
          ],
          meta: "Job security is the keystone risk — prioritize first"
        },
        {
          id: "health",
          title: "Health",
          summary:
            "Recent shoulder separation with pain, deconditioning and weight gain, poor sleep, ADHD (treated) and CAPD (aids not effective).",
          focus: [
            "14-day sleep reset (fixed wake, light, caffeine cut-off).",
            "Pain-smart movement protocol and PT guidance.",
            "Noise control and left-ear routing trial."
          ],
          meta: "Recovery capacity must rise to support execution"
        },
        {
          id: "finances",
          title: "Finances",
          summary:
            "High debt load from divorce/relationship. Income fully allocated; job risk multiplies fragility.",
          focus: [
            "Freeze discretionary spend and enforce autopay minimums.",
            "Negotiate hardship APRs with top creditors.",
            "Pause unused subscriptions and build a $200 buffer."
          ],
          meta: "Stabilize cash flow to reduce background stress"
        },
        {
          id: "relationships",
          title: "Relationships & Other",
          summary:
            "Recent breakup from a toxic LDR, grieving your dog, loneliness, and a planning → doing gap (AI rabbit holes).",
          focus: [
            "Two-slot weekly connection routine (men’s group + friend call).",
            "Therapy cadence + relapse prevention note for ex.",
            "Weekly grief ritual (photo walk, memory note)."
          ],
          meta: "Rebuild supportive community while guarding boundaries"
        }
      ],
      strategies: [
        {
          title: "Daily Chart Closure Sprint (2×30 min protected blocks)",
          lever: "job-security",
          description:
            "Quick win + major bet hybrid to reduce termination risk. Minimum viable sprint is 10 min if fatigue spikes.",
          score: 9,
          status: "active"
        },
        {
          title: "Set up Chart-Assist Kit",
          lever: "job-security",
          description:
            "Templates, checklists, dot phrases, timer, music, snack, water — remove friction and increase speed.",
          score: 8,
          status: "active"
        },
        {
          title: "Boundary Protocol for Co-parenting",
          lever: "relationships",
          description:
            "BIFF replies, mute + batch court app once daily, evidence log to reduce emotional leakage.",
          score: 8,
          status: "active"
        },
        {
          title: "Sleep Reset (14-day)",
          lever: "energy",
          description:
            "Fixed wake time, morning light exposure, caffeine cut-off, pain-aware wind-down.",
          score: 7,
          status: "active"
        },
        {
          title: "Pain-smart Movement",
          lever: "energy",
          description:
            "PT consult, 20-min daily low-impact focus on lower body/core, shoulder-safe options.",
          score: 7,
          status: "active"
        },
        {
          title: "Debt Stabilization",
          lever: "financial",
          description:
            "Spending freeze, autopay minimums, hardship APR negotiations, pause discretionary subs.",
          score: 7,
          status: "active"
        },
        {
          title: "Loneliness Antidote",
          lever: "relationships",
          description:
            "Two-slot weekly connection (men’s group or peer support + friend maintenance call).",
          score: 6,
          status: "active"
        },
        {
          title: "ADHD/CAPD Workflows",
          lever: "mindset",
          description:
            "Noise control, single-queue task board, audio-to-text notes, left-ear routing trial.",
          score: 6,
          status: "active"
        }
      ],
      roadmap: [
        {
          id: "charts",
          objective: "Close charts to regain job safety",
          milestone: "2 daily 30-min sprints × 5 days; ≥25 charts closed",
          benefit: "Lowers firing risk; momentum",
          risk: "Pain/fatigue → do minimum viable sprint (10 min) then continue",
          progress: 0,
          status: "Not Started"
        },
        {
          id: "kit",
          objective: "Install Chart-Assist Kit",
          milestone: "Create 5 templates; set timer, playlist; prep snack/water; checklist on desk",
          benefit: "Friction ↓, speed ↑",
          risk: "Perfectionism → version 0.1 now, refine later",
          progress: 0,
          status: "Not Started"
        },
        {
          id: "boundaries",
          objective: "Co-parenting Boundary Protocol",
          milestone: "BIFF replies; batch court-app 6pm daily; evidence log",
          benefit: "Emotional leakage ↓, legal hygiene ↑",
          risk: "Reactivity → write draft, wait 20 min",
          progress: 0,
          status: "Not Started"
        },
        {
          id: "sleep",
          objective: "Sleep Reset",
          milestone: "Fixed wake (6:30a), AM light, no screens last 60 min",
          benefit: "Energy, focus, mood ↑",
          risk: "Pain → heat/ice + stretch before bed",
          progress: 0,
          status: "Not Started"
        },
        {
          id: "movement",
          objective: "Pain-smart Movement",
          milestone: "PT booking + 5 sessions of 20-min low-impact",
          benefit: "Weight/mood/function ↑",
          risk: "Overdo → RPE 5–6/10 cap",
          progress: 0,
          status: "Not Started"
        }
      ],
      rituals: [
        {
          title: "Fatherhood micro-rituals",
          items: [
            "Twice-weekly 1:1 mini-adventures (30–60 min, low cost).",
            "Weekly ‘Tell Me Three’ bedtime check-in (best, worst, new).",
            "Professional updates to school/coach to counter alienation."
          ]
        },
        {
          title: "Focus & ADHD mechanics",
          items: [
            "Phone in another room; one-tab rule; noise control.",
            "Single visible task queue (Today = 1–3 items).",
            "Timer + first ugly draft for narrative sections.",
            "When anxiety spikes: 5-breath box, then resume."
          ]
        },
        {
          title: "Finance stabilizers",
          items: [
            "30-day discretionary freeze; autopay minimums.",
            "Call top 3 creditors for hardship relief.",
            "Pause unused subscriptions; start $200 buffer."
          ]
        },
        {
          title: "Relationships & grief care",
          items: [
            "Therapy cadence intact; write relapse prevention note for ex.",
            "Weekly 20-min grief ritual for your dog (photo walk, memory note).",
            "Do → Then Plan rule (20 min doing before 10 min planning)."
          ]
        }
      ],
      metrics: {
        chartsClosed: { label: "Charts Closed Today", target: 5, value: 0, unit: "charts" },
        sonTime: { label: "1:1s with Son This Week", target: 2, value: 0, unit: "sessions" },
        sleep: { label: "Sleep Hours (last night)", target: 7, value: 0, unit: "hrs" },
        movement: { label: "Movement Minutes Today", target: 20, value: 0, unit: "mins" },
        cash: { label: "Weekly Cash Delta", target: 0, value: 0, unit: "USD" }
      },
      journal: "",
      wins: []
    };

    const stateKey = "life-audit-state-v1";

    const state = JSON.parse(localStorage.getItem(stateKey)) || structuredClone(defaultState);

    const diagnosticGrid = document.getElementById("diagnostic-grid");
    const strategyGrid = document.getElementById("strategy-grid");
    const roadmapBody = document.getElementById("roadmap-body");
    const metricsGrid = document.getElementById("metrics-grid");
    const ritualsContainer = document.getElementById("rituals-container");
    const strategyForm = document.getElementById("strategy-form");
    const strategySummary = document.getElementById("strategy-summary");
    const recalcBtn = document.getElementById("recalculate-btn");
    const resetBtn = document.getElementById("reset-btn");
    const journalField = document.getElementById("journal");
    const quickWinInput = document.getElementById("quick-win-input");
    const addWinBtn = document.getElementById("add-win");
    const winsList = document.getElementById("wins-list");

    function saveState() {
      localStorage.setItem(stateKey, JSON.stringify(state));
    }

    function createDiagnosticCards() {
      diagnosticGrid.innerHTML = "";
      state.diagnostic.forEach((item) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${item.title}</h3>
          <p>${item.summary}</p>
          <ul>${item.focus.map((f) => `<li>${f}</li>`).join("")}</ul>
          <div class="card-footer">
            <span>${item.meta}</span>
          </div>
        `;
        diagnosticGrid.appendChild(card);
      });
    }

    function renderStrategies() {
      strategyGrid.innerHTML = "";
      state.strategies
        .sort((a, b) => b.score - a.score)
        .forEach((strategy) => {
          const card = document.createElement("div");
          card.className = "card light";
          const leverLabel = {
            "job-security": "Job Security",
            energy: "Energy & Recovery",
            relationships: "Relationships",
            financial: "Financial Stability",
            mindset: "Mindset & EF"
          }[strategy.lever];
          card.innerHTML = `
            <div class="tag priority">Score ${strategy.score}</div>
            <h3>${strategy.title}</h3>
            <p>${strategy.description}</p>
            <div class="card-footer">
              <span class="tag">${leverLabel}</span>
              <button type="button" data-title="${strategy.title}" class="remove-strategy" title="Remove">Remove</button>
            </div>
          `;
          const removeBtn = card.querySelector(".remove-strategy");
          removeBtn.addEventListener("click", () => removeStrategy(strategy.title));
          strategyGrid.appendChild(card);
        });
      updateStrategySummary();
    }

    function removeStrategy(title) {
      state.strategies = state.strategies.filter((s) => s.title !== title);
      saveState();
      renderStrategies();
    }

    function updateStrategySummary() {
      const topLever = state.strategies.reduce((acc, item) => {
        acc[item.lever] = (acc[item.lever] || 0) + Number(item.score || 0);
        return acc;
      }, {});
      const bestLever = Object.entries(topLever).sort((a, b) => b[1] - a[1])[0];
      const summaryText = {
        "job-security": "Job security remains the keystone. Protect the license, reduce backlog, and rebuild momentum.",
        energy: "Energy & recovery stack next: prioritize sleep, pain relief, and movement that restores confidence.",
        relationships: "Connections guard your mental health. Keep the two-slot social rhythm and professional tone.",
        financial: "Cash stabilization reduces background noise. Honor the freeze and negotiate relief early.",
        mindset: "Executive function unlock: simplify inputs, capture notes via audio-to-text, and return to single-queue focus."
      };
      const text = bestLever ? summaryText[bestLever[0]] : "Rebuild your stack to discover the current focal lever.";
      document.getElementById("top-lever-text").textContent = text;
    }

    function renderRoadmap() {
      roadmapBody.innerHTML = "";
      state.roadmap.forEach((item) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td data-label="Objective">${item.objective}</td>
          <td data-label="Milestone">${item.milestone}</td>
          <td data-label="Benefit">${item.benefit}</td>
          <td data-label="Risk">${item.risk}</td>
          <td data-label="Status">
            <select class="status-select" data-id="${item.id}">
              <option${item.status === "Not Started" ? " selected" : ""}>Not Started</option>
              <option${item.status === "In Progress" ? " selected" : ""}>In Progress</option>
              <option${item.status === "Done" ? " selected" : ""}>Done</option>
            </select>
          </td>
          <td data-label="Progress">
            <input type="number" min="0" max="100" class="progress-input" value="${item.progress}" data-id="${item.id}" />
            <div class="progress-bar"><span style="width:${item.progress}%"></span></div>
          </td>
        `;
        roadmapBody.appendChild(tr);
      });

      roadmapBody.querySelectorAll(".status-select").forEach((select) => {
        select.addEventListener("change", (event) => {
          const id = event.target.dataset.id;
          const item = state.roadmap.find((r) => r.id === id);
          if (item) {
            item.status = event.target.value;
            saveState();
          }
        });
      });

      roadmapBody.querySelectorAll(".progress-input").forEach((input) => {
        input.addEventListener("input", (event) => {
          const id = event.target.dataset.id;
          const value = Math.min(100, Math.max(0, Number(event.target.value)));
          const item = state.roadmap.find((r) => r.id === id);
          if (item) {
            item.progress = value;
            event.target.nextElementSibling.firstElementChild.style.width = `${value}%`;
            saveState();
          }
        });
      });
    }

    function renderRituals() {
      ritualsContainer.innerHTML = "";
      state.rituals.forEach((ritual) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${ritual.title}</h3>
          <ul>${ritual.items.map((item) => `<li>${item}</li>`).join("")}</ul>
        `;
        ritualsContainer.appendChild(card);
      });
    }

    function renderMetrics() {
      metricsGrid.innerHTML = "";
      Object.entries(state.metrics).forEach(([key, metric]) => {
        const card = document.createElement("div");
        card.className = "metric-card";
        const pct = metric.target ? Math.min(100, Math.round((metric.value / metric.target) * 100)) : 0;
        card.innerHTML = `
          <h3>${metric.label}</h3>
          <input type="number" id="metric-${key}" value="${metric.value}" />
          <div class="progress-bar"><span style="width:${pct}%"></span></div>
          <small>Target: ${metric.target} ${metric.unit}</small>
        `;
        const input = card.querySelector("input");
        input.addEventListener("input", (event) => {
          const value = Number(event.target.value || 0);
          state.metrics[key].value = value;
          const percent = metric.target ? Math.min(100, Math.round((value / metric.target) * 100)) : 0;
          card.querySelector(".progress-bar span").style.width = `${percent}%`;
          saveState();
        });
        metricsGrid.appendChild(card);
      });
    }

    function renderWins() {
      winsList.innerHTML = "";
      state.wins.forEach((win, index) => {
        const li = document.createElement("li");
        li.innerHTML = `<span>${win}</span><button type="button" data-index="${index}">Remove</button>`;
        li.querySelector("button").addEventListener("click", (event) => {
          const idx = Number(event.target.dataset.index);
          state.wins.splice(idx, 1);
          saveState();
          renderWins();
        });
        winsList.appendChild(li);
      });
    }

    strategyForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const formData = new FormData(strategyForm);
      const newStrategy = {
        title: formData.get("title").trim(),
        description: formData.get("purpose").trim(),
        lever: formData.get("lever"),
        score: Number(formData.get("score")) || 5,
        status: "active"
      };
      if (!newStrategy.title || !newStrategy.description) return;
      state.strategies.push(newStrategy);
      saveState();
      strategyForm.reset();
      renderStrategies();
    });

    recalcBtn.addEventListener("click", () => {
      updateStrategySummary();
      recalcBtn.textContent = "Focus Updated";
      setTimeout(() => (recalcBtn.textContent = "Recalculate Focus"), 1600);
    });

    resetBtn.addEventListener("click", () => {
      Object.assign(state, structuredClone(defaultState));
      saveState();
      createDiagnosticCards();
      renderStrategies();
      renderRoadmap();
      renderRituals();
      renderMetrics();
      journalField.value = state.journal;
      renderWins();
    });

    journalField.value = state.journal;
    journalField.addEventListener("input", (event) => {
      state.journal = event.target.value;
      saveState();
    });

    addWinBtn.addEventListener("click", () => {
      const value = quickWinInput.value.trim();
      if (!value) return;
      const timestamp = new Date().toLocaleString();
      state.wins.unshift(`${timestamp} — ${value}`);
      quickWinInput.value = "";
      saveState();
      renderWins();
    });

    document.querySelectorAll("nav button[data-scroll]").forEach((button) => {
      button.addEventListener("click", () => {
        const target = document.getElementById(button.dataset.scroll);
        if (target) {
          target.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
    });

    createDiagnosticCards();
    renderStrategies();
    renderRoadmap();
    renderRituals();
    renderMetrics();
    renderWins();
  </script>
</body>
</html>
